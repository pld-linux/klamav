http://www.gossamer-threads.com/lists/clamav/devel/35026?page=last

--- klamav-0.41.1-source/klamav-0.41.1/src/klamd/scanner.c~	2007-07-24 21:51:51.000000000 +0200
+++ klamav-0.41.1-source/klamav-0.41.1/src/klamd/scanner.c	2007-12-25 01:04:53.676444036 +0100
@@ -396,7 +396,7 @@
 
     logg("*Accepted connection on port %d, fd %d\n", port, acceptd);
 
-    if ((tmpname = cli_gentempdesc(NULL, &tmpd)) == NULL) {
+    if (cli_gentempfd(NULL, &tmpname, &tmpd)) {
 	shutdown(sockfd, 2);
 	close(sockfd);
 	close(acceptd);
--- klamav-0.41.1-source/klamav-0.41.1/src/klamd/scanner.h~	2007-07-24 21:51:51.000000000 +0200
+++ klamav-0.41.1-source/klamav-0.41.1/src/klamd/scanner.h	2007-12-25 01:05:02.846906907 +0100
@@ -33,4 +33,6 @@
 
 int checksymlink(const char *path);
 
+extern int  cli_gentempfd(const char *dir, char **name, int *fd);
+
 #endif
